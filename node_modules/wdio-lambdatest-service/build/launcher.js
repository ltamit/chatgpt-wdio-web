"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _formData = _interopRequireDefault(require("form-data"));
var _fs = _interopRequireDefault(require("fs"));
var _axios = _interopRequireDefault(require("axios"));
var _perf_hooks = require("perf_hooks");
var _logger = _interopRequireDefault(require("@wdio/logger"));
var _nodeTunnel = _interopRequireDefault(require("@lambdatest/node-tunnel"));
var _constants = require("./constants.js");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
const log = (0, _logger.default)('@wdio/lambdatest-service');
const colors = require('colors');
class LambdaTestLauncher {
  constructor(options) {
    _defineProperty(this, "lambdatestTunnelProcess", void 0);
    _defineProperty(this, "options", void 0);
    this.options = options;
  }
  async onPrepare(config, capabilities) {
    if (this.options.app_upload) {
      try {
        var _this$options$app, _this$options$app$app, _this$options$app2, _this$options$app$app2, _this$options$app3, _this$options$app$cus, _this$options$app4;
        const appName = (_this$options$app = this.options.app) === null || _this$options$app === void 0 ? void 0 : _this$options$app.app_name;
        if (!appName) throw new Error(colors.yellow('App name is missing.\n'));
        const appPath = (_this$options$app$app = (_this$options$app2 = this.options.app) === null || _this$options$app2 === void 0 ? void 0 : _this$options$app2.app_path) !== null && _this$options$app$app !== void 0 ? _this$options$app$app : null;
        const appUrl = (_this$options$app$app2 = (_this$options$app3 = this.options.app) === null || _this$options$app3 === void 0 ? void 0 : _this$options$app3.app_url) !== null && _this$options$app$app2 !== void 0 ? _this$options$app$app2 : null;
        const customId = (_this$options$app$cus = (_this$options$app4 = this.options.app) === null || _this$options$app4 === void 0 ? void 0 : _this$options$app4.custom_id) !== null && _this$options$app$cus !== void 0 ? _this$options$app$cus : null;
        let data = new _formData.default();
        data.append('name', appName);
        data.append(appPath !== null ? 'appFile' : 'url', appPath !== null ? _fs.default.createReadStream(appPath) : appUrl);
        data.append('custom_id', customId);
        let headerEnv = `Basic ${Buffer.from(config.user + ':' + config.key).toString('base64')}`;
        let body = {
          method: 'post',
          maxBodyLength: Infinity,
          url: 'https://manual-api.lambdatest.com/app/upload/realDevice',
          headers: {
            'Authorization': headerEnv,
            ...data.getHeaders()
          },
          data: data
        };
        const response = await _axios.default.request(body);
        console.log(colors.green(JSON.stringify(response.data)));
        const envAppUrl = response.data.app_url;
        if (this.options.app.enableCapability) {
          for (let i = 0; i < capabilities.length; i++) {
            capabilities[i].app = envAppUrl;
          }
        }
        const appId = response.data.app_id;
        if (appPath && appPath.includes('.apk') || appUrl && appUrl.includes('.apk')) {
          await checkPatchUrl(appId, headerEnv);
        }
      } catch (error) {
        console.error(error.message);
      }
    }
    if (!this.options.tunnel) {
      return;
    }
    const tunnelArguments = {
      user: config.user,
      key: config.key,
      ...this.options.lambdatestOpts
    };
    this.lambdatestTunnelProcess = new _nodeTunnel.default();
    if (Array.isArray(capabilities)) {
      capabilities.forEach(capability => {
        if (capability['LT:Options'] === undefined) capability.tunnel = true;else capability['LT:Options'].tunnel = true;
      });
    } else if (typeof capabilities === 'object') {
      if (capabilities['LT:Options'] === undefined) capabilities.tunnel = true;else capabilities['LT:Options'].tunnel = true;
    }
    const obs = new _perf_hooks.PerformanceObserver(list => {
      const entry = list.getEntries()[0];
      log.info(`LambdaTest Tunnel successfully started after ${entry.duration}ms`);
    });
    obs.observe({
      entryTypes: ['measure'],
      buffered: false
    });
    let timer;
    _perf_hooks.performance.mark('ltTunnelStart');
    return Promise.race([new Promise((resolve, reject) => {
      this.lambdatestTunnelProcess.start(tunnelArguments, err => {
        if (err) {
          obs.disconnect();
          return reject(err);
        }
        this.lambdatestTunnelProcess.getTunnelName(tunnelName => {
          if (Array.isArray(capabilities)) {
            capabilities.forEach(capability => {
              if (capability['LT:Options'] === undefined) capability.tunnelName = tunnelName;else capability['LT:Options'].tunnelName = tunnelName;
            });
          } else if (typeof capabilities === 'object') {
            if (capabilities['LT:Options'] === undefined) capabilities.tunnelName = tunnelName;else capabilities['LT:Options'].tunnelName = tunnelName;
          }
          obs.disconnect();
          resolve();
        });
      });
    }), new Promise((resolve, reject) => {
      timer = setTimeout(() => {
        obs.disconnect();
        reject(new Error(_constants.TUNNEL_START_FAILED));
      }, _constants.TUNNEL_STOP_TIMEOUT);
    })]).then(result => {
      clearTimeout(timer);
      _perf_hooks.performance.mark('ltTunnelEnd');
      _perf_hooks.performance.measure('bootTime', 'ltTunnelStart', 'ltTunnelEnd');
      obs.disconnect();
      return Promise.resolve(result);
    }, err => {
      clearTimeout(timer);
      obs.disconnect();
      return Promise.reject(err);
    });
  }
  onComplete() {
    if (!this.lambdatestTunnelProcess || typeof this.lambdatestTunnelProcess.isRunning !== 'function' || !this.lambdatestTunnelProcess.isRunning()) {
      return;
    }
    let timer;
    return Promise.race([new Promise((resolve, reject) => {
      this.lambdatestTunnelProcess.stop(err => {
        if (err) return reject(err);
        resolve();
      });
    }), new Promise((resolve, reject) => {
      timer = setTimeout(() => reject(new Error(_constants.TUNNEL_STOP_FAILED)), _constants.TUNNEL_STOP_TIMEOUT);
    })]).then(() => {
      clearTimeout(timer);
      return Promise.resolve();
    }, err => {
      clearTimeout(timer);
      return Promise.reject(err);
    });
  }
}
exports.default = LambdaTestLauncher;
async function checkPatchUrl(appId, headerEnv) {
  let config = {
    method: 'get',
    maxBodyLength: Infinity,
    url: `https://manual-api.lambdatest.com/app/${appId}/url?reinstall=true`,
    headers: {
      'Authorization': headerEnv
    }
  };
  let isLoaded = false;
  while (!isLoaded) {
    try {
      const response = await _axios.default.request(config);
      const patchedUrl = response.data.patched_url;
      if (patchedUrl !== null) {
        isLoaded = true;
        break;
      }
      console.log('Waiting for app to be loaded...');
    } catch (error) {
      console.error('Error occurred:', error.message);
    }
    await new Promise(resolve => setTimeout(resolve, 15000));
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZm9ybURhdGEiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9mcyIsIl9heGlvcyIsIl9wZXJmX2hvb2tzIiwiX2xvZ2dlciIsIl9ub2RlVHVubmVsIiwiX2NvbnN0YW50cyIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiX2RlZmluZVByb3BlcnR5Iiwia2V5IiwidmFsdWUiLCJfdG9Qcm9wZXJ0eUtleSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiYXJnIiwiX3RvUHJpbWl0aXZlIiwiU3RyaW5nIiwiaW5wdXQiLCJoaW50IiwicHJpbSIsIlN5bWJvbCIsInRvUHJpbWl0aXZlIiwidW5kZWZpbmVkIiwicmVzIiwiY2FsbCIsIlR5cGVFcnJvciIsIk51bWJlciIsImxvZyIsImxvZ2dlciIsImNvbG9ycyIsIkxhbWJkYVRlc3RMYXVuY2hlciIsImNvbnN0cnVjdG9yIiwib3B0aW9ucyIsIm9uUHJlcGFyZSIsImNvbmZpZyIsImNhcGFiaWxpdGllcyIsImFwcF91cGxvYWQiLCJfdGhpcyRvcHRpb25zJGFwcCIsIl90aGlzJG9wdGlvbnMkYXBwJGFwcCIsIl90aGlzJG9wdGlvbnMkYXBwMiIsIl90aGlzJG9wdGlvbnMkYXBwJGFwcDIiLCJfdGhpcyRvcHRpb25zJGFwcDMiLCJfdGhpcyRvcHRpb25zJGFwcCRjdXMiLCJfdGhpcyRvcHRpb25zJGFwcDQiLCJhcHBOYW1lIiwiYXBwIiwiYXBwX25hbWUiLCJFcnJvciIsInllbGxvdyIsImFwcFBhdGgiLCJhcHBfcGF0aCIsImFwcFVybCIsImFwcF91cmwiLCJjdXN0b21JZCIsImN1c3RvbV9pZCIsImRhdGEiLCJGb3JtRGF0YSIsImFwcGVuZCIsImZzIiwiY3JlYXRlUmVhZFN0cmVhbSIsImhlYWRlckVudiIsIkJ1ZmZlciIsImZyb20iLCJ1c2VyIiwidG9TdHJpbmciLCJib2R5IiwibWV0aG9kIiwibWF4Qm9keUxlbmd0aCIsIkluZmluaXR5IiwidXJsIiwiaGVhZGVycyIsImdldEhlYWRlcnMiLCJyZXNwb25zZSIsImF4aW9zIiwicmVxdWVzdCIsImNvbnNvbGUiLCJncmVlbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJlbnZBcHBVcmwiLCJlbmFibGVDYXBhYmlsaXR5IiwiaSIsImxlbmd0aCIsImFwcElkIiwiYXBwX2lkIiwiaW5jbHVkZXMiLCJjaGVja1BhdGNoVXJsIiwiZXJyb3IiLCJtZXNzYWdlIiwidHVubmVsIiwidHVubmVsQXJndW1lbnRzIiwibGFtYmRhdGVzdE9wdHMiLCJsYW1iZGF0ZXN0VHVubmVsUHJvY2VzcyIsIkxhbWJkYVRlc3RUdW5uZWxMYXVuY2hlciIsIkFycmF5IiwiaXNBcnJheSIsImZvckVhY2giLCJjYXBhYmlsaXR5Iiwib2JzIiwiUGVyZm9ybWFuY2VPYnNlcnZlciIsImxpc3QiLCJlbnRyeSIsImdldEVudHJpZXMiLCJpbmZvIiwiZHVyYXRpb24iLCJvYnNlcnZlIiwiZW50cnlUeXBlcyIsImJ1ZmZlcmVkIiwidGltZXIiLCJwZXJmb3JtYW5jZSIsIm1hcmsiLCJQcm9taXNlIiwicmFjZSIsInJlc29sdmUiLCJyZWplY3QiLCJzdGFydCIsImVyciIsImRpc2Nvbm5lY3QiLCJnZXRUdW5uZWxOYW1lIiwidHVubmVsTmFtZSIsInNldFRpbWVvdXQiLCJUVU5ORUxfU1RBUlRfRkFJTEVEIiwiVFVOTkVMX1NUT1BfVElNRU9VVCIsInRoZW4iLCJyZXN1bHQiLCJjbGVhclRpbWVvdXQiLCJtZWFzdXJlIiwib25Db21wbGV0ZSIsImlzUnVubmluZyIsInN0b3AiLCJUVU5ORUxfU1RPUF9GQUlMRUQiLCJleHBvcnRzIiwiaXNMb2FkZWQiLCJwYXRjaGVkVXJsIiwicGF0Y2hlZF91cmwiXSwic291cmNlcyI6WyIuLi9zcmMvbGF1bmNoZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEZvcm1EYXRhIGZyb20gJ2Zvcm0tZGF0YSc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcblxuaW1wb3J0IHsgcGVyZm9ybWFuY2UsIFBlcmZvcm1hbmNlT2JzZXJ2ZXIgfSBmcm9tICdwZXJmX2hvb2tzJ1xuaW1wb3J0IGxvZ2dlciBmcm9tICdAd2Rpby9sb2dnZXInXG5pbXBvcnQgTGFtYmRhVGVzdFR1bm5lbExhdW5jaGVyIGZyb20gJ0BsYW1iZGF0ZXN0L25vZGUtdHVubmVsJ1xuaW1wb3J0IHsgVFVOTkVMX1NUQVJUX0ZBSUxFRCwgVFVOTkVMX1NUT1BfRkFJTEVELCBUVU5ORUxfU1RPUF9USU1FT1VUIH0gZnJvbSAnLi9jb25zdGFudHMuanMnXG5jb25zdCBsb2cgPSBsb2dnZXIoJ0B3ZGlvL2xhbWJkYXRlc3Qtc2VydmljZScpXG5jb25zdCBjb2xvcnMgPSByZXF1aXJlKCdjb2xvcnMnKTtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExhbWJkYVRlc3RMYXVuY2hlciB7XG4gICAgbGFtYmRhdGVzdFR1bm5lbFByb2Nlc3NcbiAgICBvcHRpb25zXG5cbiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnNcbiAgICB9XG5cbiAgICAvLyBtb2RpZnkgY29uZmlnIGFuZCBsYXVuY2ggdHVubmVsXG4gICAgYXN5bmMgb25QcmVwYXJlKGNvbmZpZywgY2FwYWJpbGl0aWVzKSB7XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hcHBfdXBsb2FkKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBjb25zdCBhcHBOYW1lID0gdGhpcy5vcHRpb25zLmFwcD8uYXBwX25hbWU7XG4gICAgICAgICAgICAgIGlmICghYXBwTmFtZSkgdGhyb3cgbmV3IEVycm9yKGNvbG9ycy55ZWxsb3coJ0FwcCBuYW1lIGlzIG1pc3NpbmcuXFxuJykpO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgY29uc3QgYXBwUGF0aCA9IHRoaXMub3B0aW9ucy5hcHA/LmFwcF9wYXRoID8/IG51bGw7XG4gICAgICAgICAgICAgIGNvbnN0IGFwcFVybCA9IHRoaXMub3B0aW9ucy5hcHA/LmFwcF91cmwgPz8gbnVsbDtcbiAgICAgICAgICAgICAgY29uc3QgY3VzdG9tSWQgPSB0aGlzLm9wdGlvbnMuYXBwPy5jdXN0b21faWQgPz8gbnVsbDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgICBsZXQgZGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xuICAgICAgICAgICAgICBkYXRhLmFwcGVuZCgnbmFtZScsIGFwcE5hbWUpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGRhdGEuYXBwZW5kKGFwcFBhdGggIT09IG51bGwgPyAnYXBwRmlsZScgOiAndXJsJywgYXBwUGF0aCAhPT0gbnVsbCA/IGZzLmNyZWF0ZVJlYWRTdHJlYW0oYXBwUGF0aCkgOiBhcHBVcmwpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdjdXN0b21faWQnLCBjdXN0b21JZCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICAgbGV0IGhlYWRlckVudiA9IGBCYXNpYyAke0J1ZmZlci5mcm9tKGNvbmZpZy51c2VyICsgJzonICsgY29uZmlnLmtleSkudG9TdHJpbmcoJ2Jhc2U2NCcpfWA7XG4gICAgICAgICAgICAgIGxldCBib2R5ID0ge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogJ3Bvc3QnLFxuICAgICAgICAgICAgICAgIG1heEJvZHlMZW5ndGg6IEluZmluaXR5LFxuICAgICAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vbWFudWFsLWFwaS5sYW1iZGF0ZXN0LmNvbS9hcHAvdXBsb2FkL3JlYWxEZXZpY2UnLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogaGVhZGVyRW52LFxuICAgICAgICAgICAgICAgICAgLi4uZGF0YS5nZXRIZWFkZXJzKClcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLnJlcXVlc3QoYm9keSk7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGNvbG9ycy5ncmVlbihKU09OLnN0cmluZ2lmeShyZXNwb25zZS5kYXRhKSkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGNvbnN0IGVudkFwcFVybCA9IHJlc3BvbnNlLmRhdGEuYXBwX3VybDtcbiAgICAgICAgICAgICAgaWYodGhpcy5vcHRpb25zLmFwcC5lbmFibGVDYXBhYmlsaXR5KVxuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjYXBhYmlsaXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgY2FwYWJpbGl0aWVzW2ldLmFwcCA9IGVudkFwcFVybDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBhcHBJZCA9IHJlc3BvbnNlLmRhdGEuYXBwX2lkO1xuICAgICAgICAgICAgaWYoKGFwcFBhdGggJiYgYXBwUGF0aC5pbmNsdWRlcygnLmFwaycpKSB8fCAoYXBwVXJsICYmIGFwcFVybC5pbmNsdWRlcygnLmFwaycpKSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBjaGVja1BhdGNoVXJsKGFwcElkLCBoZWFkZXJFbnYpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMudHVubmVsKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHR1bm5lbEFyZ3VtZW50cyA9IHtcbiAgICAgICAgICAgIHVzZXI6IGNvbmZpZy51c2VyLFxuICAgICAgICAgICAga2V5OiBjb25maWcua2V5LFxuICAgICAgICAgICAgLi4udGhpcy5vcHRpb25zLmxhbWJkYXRlc3RPcHRzXG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmxhbWJkYXRlc3RUdW5uZWxQcm9jZXNzID0gbmV3IExhbWJkYVRlc3RUdW5uZWxMYXVuY2hlcigpXG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY2FwYWJpbGl0aWVzKSkge1xuICAgICAgICAgICAgY2FwYWJpbGl0aWVzLmZvckVhY2goY2FwYWJpbGl0eSA9PiB7XG4gICAgICAgICAgICAgICAgaWYoY2FwYWJpbGl0eVsnTFQ6T3B0aW9ucyddPT09dW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICBjYXBhYmlsaXR5LnR1bm5lbCA9IHRydWVcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGNhcGFiaWxpdHlbJ0xUOk9wdGlvbnMnXS50dW5uZWwgPSB0cnVlXG4gICAgICAgICAgICB9KVxuICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBjYXBhYmlsaXRpZXMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBpZihjYXBhYmlsaXRpZXNbJ0xUOk9wdGlvbnMnXT09PXVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICBjYXBhYmlsaXRpZXMudHVubmVsID0gdHJ1ZVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGNhcGFiaWxpdGllc1snTFQ6T3B0aW9ucyddLnR1bm5lbCA9IHRydWVcbiAgICAgICAgfVxuICAgICAgICAvLyBtZWFzdXJlIExUIGJvb3QgdGltZVxuICAgICAgICBjb25zdCBvYnMgPSBuZXcgUGVyZm9ybWFuY2VPYnNlcnZlcihsaXN0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGVudHJ5ID0gbGlzdC5nZXRFbnRyaWVzKClbMF1cbiAgICAgICAgICAgIGxvZy5pbmZvKFxuICAgICAgICAgICAgICAgIGBMYW1iZGFUZXN0IFR1bm5lbCBzdWNjZXNzZnVsbHkgc3RhcnRlZCBhZnRlciAke2VudHJ5LmR1cmF0aW9ufW1zYFxuICAgICAgICAgICAgKVxuICAgICAgICB9KVxuICAgICAgICBvYnMub2JzZXJ2ZSh7IGVudHJ5VHlwZXM6IFsnbWVhc3VyZSddLCBidWZmZXJlZDogZmFsc2UgfSlcblxuICAgICAgICBsZXQgdGltZXJcbiAgICAgICAgcGVyZm9ybWFuY2UubWFyaygnbHRUdW5uZWxTdGFydCcpXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJhY2UoW1xuICAgICAgICAgICAgLyoqIEB0eXBlIHtQcm9taXNlPHZvaWQ+fSAqLyhuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5sYW1iZGF0ZXN0VHVubmVsUHJvY2Vzcy5zdGFydCh0dW5uZWxBcmd1bWVudHMsIGVyciA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9icy5kaXNjb25uZWN0KClcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoZXJyKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGFtYmRhdGVzdFR1bm5lbFByb2Nlc3MuZ2V0VHVubmVsTmFtZSh0dW5uZWxOYW1lID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGNhcGFiaWxpdGllcykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXBhYmlsaXRpZXMuZm9yRWFjaChjYXBhYmlsaXR5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2FwYWJpbGl0eVsnTFQ6T3B0aW9ucyddPT09dW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwYWJpbGl0eS50dW5uZWxOYW1lID0gdHVubmVsTmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXBhYmlsaXR5WydMVDpPcHRpb25zJ10udHVubmVsTmFtZSA9IHR1bm5lbE5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgY2FwYWJpbGl0aWVzID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNhcGFiaWxpdGllc1snTFQ6T3B0aW9ucyddPT09dW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXBhYmlsaXRpZXMudHVubmVsTmFtZSA9IHR1bm5lbE5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcGFiaWxpdGllc1snTFQ6T3B0aW9ucyddLnR1bm5lbE5hbWUgPSB0dW5uZWxOYW1lXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBvYnMuZGlzY29ubmVjdCgpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKClcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgICAgICAgICAgICAgdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgb2JzLmRpc2Nvbm5lY3QoKVxuICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKFRVTk5FTF9TVEFSVF9GQUlMRUQpKVxuICAgICAgICAgICAgICAgIH0sIFRVTk5FTF9TVE9QX1RJTUVPVVQpXG4gICAgICAgICAgICB9KVxuICAgICAgICBdKS50aGVuKFxuICAgICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAgICAgICAgIChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpXG4gICAgICAgICAgICAgICAgcGVyZm9ybWFuY2UubWFyaygnbHRUdW5uZWxFbmQnKVxuICAgICAgICAgICAgICAgIHBlcmZvcm1hbmNlLm1lYXN1cmUoJ2Jvb3RUaW1lJywgJ2x0VHVubmVsU3RhcnQnLCAnbHRUdW5uZWxFbmQnKVxuICAgICAgICAgICAgICAgIG9icy5kaXNjb25uZWN0KClcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdClcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKVxuICAgICAgICAgICAgICAgIG9icy5kaXNjb25uZWN0KClcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyKVxuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgfVxuXG4gICAgb25Db21wbGV0ZSgpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICAgIXRoaXMubGFtYmRhdGVzdFR1bm5lbFByb2Nlc3MgfHxcbiAgICAgICAgICAgIHR5cGVvZiB0aGlzLmxhbWJkYXRlc3RUdW5uZWxQcm9jZXNzLmlzUnVubmluZyAhPT0gJ2Z1bmN0aW9uJyB8fFxuICAgICAgICAgICAgIXRoaXMubGFtYmRhdGVzdFR1bm5lbFByb2Nlc3MuaXNSdW5uaW5nKClcbiAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB0aW1lclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yYWNlKFtcbiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmxhbWJkYXRlc3RUdW5uZWxQcm9jZXNzLnN0b3AoZXJyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGVycikgcmV0dXJuIHJlamVjdChlcnIpXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqL1xuICAgICAgICAgICAgICAgIHRpbWVyID0gc2V0VGltZW91dCgoKSA9PiByZWplY3QoIG5ldyBFcnJvcihUVU5ORUxfU1RPUF9GQUlMRUQpKSwgVFVOTkVMX1NUT1BfVElNRU9VVClcbiAgICAgICAgICAgIH0pXG4gICAgICAgIF0pLnRoZW4oXG4gICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKVxuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgICAgICAgICAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKVxuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnIpXG4gICAgICAgICAgICB9XG4gICAgICAgIClcbiAgICB9XG5cbn1cblxuYXN5bmMgZnVuY3Rpb24gY2hlY2tQYXRjaFVybChhcHBJZCwgaGVhZGVyRW52KSB7XG4gICAgbGV0IGNvbmZpZyA9IHtcbiAgICAgICAgbWV0aG9kOiAnZ2V0JyxcbiAgICAgICAgbWF4Qm9keUxlbmd0aDogSW5maW5pdHksXG4gICAgICAgIHVybDogYGh0dHBzOi8vbWFudWFsLWFwaS5sYW1iZGF0ZXN0LmNvbS9hcHAvJHthcHBJZH0vdXJsP3JlaW5zdGFsbD10cnVlYCxcbiAgICAgICAgaGVhZGVyczogeyBcbiAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGhlYWRlckVudlxuICAgICAgICB9XG4gICAgICB9O1xuICAgIGxldCBpc0xvYWRlZCA9IGZhbHNlO1xuICAgIHdoaWxlICghaXNMb2FkZWQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5yZXF1ZXN0KGNvbmZpZyk7XG4gICAgICAgIGNvbnN0IHBhdGNoZWRVcmwgPSByZXNwb25zZS5kYXRhLnBhdGNoZWRfdXJsO1xuXG4gICAgICAgIGlmIChwYXRjaGVkVXJsICE9PSBudWxsKSB7XG4gICAgICAgICAgICBpc0xvYWRlZCA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKCdXYWl0aW5nIGZvciBhcHAgdG8gYmUgbG9hZGVkLi4uJyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG9jY3VycmVkOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gV2FpdCBmb3IgMTUgc2Vjb25kcyBiZWZvcmUgbWFraW5nIHRoZSBuZXh0IHJlcXVlc3RcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDE1MDAwKSk7XG4gICAgfVxufSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBLElBQUFBLFNBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLEdBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFFLE1BQUEsR0FBQUgsc0JBQUEsQ0FBQUMsT0FBQTtBQUVBLElBQUFHLFdBQUEsR0FBQUgsT0FB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